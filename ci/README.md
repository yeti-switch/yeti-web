# Building debian package
There are some non-standard requirements to build a package. E.g. Debian changelog is generated using custom tool that is installed from yeti repository. So it's advised to use docker to build package. Dockerfiles are `build_jessie.Dockerfile` and `build_stretch.Dockerfile` for building in jessie and stretch enviroment respectively. Building of a package involves building of the documentation, which is generated by doing api requests to a working application. This step requires working database. You can launch it using `ci/pgsql.Dockerfile`. Note that this image is built from `debian:jessie` image instead of `postgres:9.4`, because we need `postgresql-9.4-pgq3` package exactly from debian repository. Generally, the sequence of commands to build package is:

```bash
$ docker build -t pgsql_yeti -f ./ci/pgsql.Dockerfile .
$ docker network create yeti-net
$ docker run -d --network yeti-net -p 5432:5432 --name db pgsql_yeti
$ docker build -t yeti-web -f ./ci/build_jessie.Dockerfile .
$ docker run --network yeti-net --name yeti-web yeti-web
```

On successful build `.deb` file will be in `/build/` directory of `yeti-web` container. You can inspect it using these commands:
```
$ docker commit yeti-web yeti-web:built
$ docker run --name yeti-web-built -it yeti-web:built /bin/bash
```

Generally speaking, check out `.travis-ci.yml` to learn how packages are built currentrly. Also, all steps above may be done in environment similar to one, that travis provides using Vagrant. Install vagrant, invoke `vagrant up` and `vagrant ssh` and you ready to go. Make sure you sync'ed your source on host and in virtual machine by invoking `vagrant provision`.
